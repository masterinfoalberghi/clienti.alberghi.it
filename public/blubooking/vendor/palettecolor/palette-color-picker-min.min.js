!function(t){"use strict";t.paletteColorPicker=function(e,a){var s="palette-color-picker",n=t(e),i=this,o=n.val(),r=n.attr("name"),l=t("<div>").addClass(s+"-button").attr("data-target",r),c=t("<div>").addClass(s+"-bubble"),u={custom_class:null,colors:null,position:"upside",insert:"before",clear_btn:"first",timeout:2e3,set_background:!1,close_all_but_this:!1},d="ontouchstart"in document.documentElement?"touchstart click":"click";i.init=function(){i.settings=t.extend({},u,a);var e=n.attr("value");if(void 0!==e&&!1!==e||(e="",n.attr("value",e)),n.attr("data-initialvalue",n.attr("value")),null===i.settings.colors&&(i.settings.colors=n.data("palette")),"string"==typeof i.settings.colors[0]&&(i.settings.colors=t.map(i.settings.colors,function(t,e){var a={};return a[t]=t,a})),i.settings.insert=i.settings.insert.charAt(0).toUpperCase()+i.settings.insert.slice(1),i.settings.custom_class&&c.addClass(i.settings.custom_class),t.each(i.settings.colors,function(e,a){var s=Object.keys(a)[0],n=a[s],i=t("<span>").addClass("swatch").attr({title:s,"data-color":n,"data-name":s}).css("background-color",n);s===o&&(i.addClass("active"),l.css("background",n)),i.appendTo(c)}),null!==i.settings.clear_btn){var r=t("<span>").addClass("swatch clear").attr("title","Clear selection");"last"===i.settings.clear_btn?r.addClass("last").appendTo(c):r.prependTo(c)}i.destroy=function(){l.remove(),t.removeData(n[0])},i.clear=function(){c.find(".active").removeClass("active"),l.removeAttr("style"),n.val("")},i.reset=function(){if(""===n.attr("data-initialvalue"))i.clear();else{var t=n.attr("data-initialvalue");c.find('[data-name="'+t+'"]').trigger("click")}},i.reload=function(){var t=n.val();""===t||void 0===t||!1===t?i.reset():c.find('[data-name="'+t+'"]').length?c.find('[data-name="'+t+'"]').trigger("click"):i.reset()},l.append(c).on(d,function(e){e.preventDefault(),e.stopPropagation();var a=t(this);if(!t(e.target).hasClass(s+"-bubble")){"function"==typeof i.settings.onbeforeshow_callback&&i.settings.onbeforeshow_callback(this),a.toggleClass("active");var n=a.find("."+s+"-bubble");i.settings.close_all_but_this&&t("."+s+"-bubble").not(n).fadeOut(),n.fadeToggle(),a.hasClass("active")&&(clearTimeout(i.timer),i.timer=setTimeout(function(){a.trigger("pcp.fadeout")},i.settings.timeout))}}).on("pcp.fadeout",function(){t(this).removeClass("active").find("."+s+"-bubble").fadeOut()}).on("mouseenter","."+s+"-bubble",function(){clearTimeout(i.timer)}).on("mouseleave","."+s+"-bubble",function(){i.timer=setTimeout(function(){l.trigger("pcp.fadeout")},i.settings.timeout)}).on(d,"."+s+"-bubble span.swatch",function(e){e.preventDefault(),e.stopPropagation();var a=t(this).attr("data-color"),n=t(this).attr("data-name"),o=t("."+s+'-button[data-target="'+t(this).closest("."+s+"-button").attr("data-target")+'"]');t(this).closest("."+s+"-bubble").find(".active").removeClass("active"),t(e.target).is(".clear")?(o.removeAttr("style"),a=""):(t(this).addClass("active"),o.css("background",a)),"function"==typeof i.settings.onchange_callback&&i.settings.onchange_callback(a),!1===i.settings.set_background?t('[name="'+o.attr("data-target")+'"]').val(n):t('[name="'+o.attr("data-target")+'"]').css({"background-color":a})})["insert"+i.settings.insert](n),("downside"===i.settings.position||n.offset().top+20<c.outerHeight())&&c.addClass("downside")},t("body").on(d,function(e){t(e.target).hasClass(s+"-button")||t(l).removeClass("active").find("."+s+"-bubble").fadeOut()}),i.init()},t.fn.paletteColorPicker=function(e){return this.each(function(){void 0===t(this).data("paletteColorPickerPlugin")&&t(this).data("paletteColorPickerPlugin",new t.paletteColorPicker(this,e))})}}(jQuery);