var checkin=[],checkout=[],first=!0;$(function(){function e(e){var a=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return 0==e.length?0:a.test(e)?10:1}function a(e){return 0==e.length?0:e.length<3?1:10}function t(e){var a=/^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{0,6}$/im;return 0==e.length?0:a.test(e)?10:1}function r(e){var a=e.split("/");return[a[2],a[1],a[0]].join("-")}function o(e){var a=new Date(r($("#arrivo_"+e).val())),t=new Date(r($("#partenza_"+e).val())),o=a.getDay(),i=t.getDay(),n=Math.abs(t-a)/1e3/60/60/24;if(isNaN(n))$("#date_night_"+e).html("");else{var s=night;n>1&&(s=nights),n=n+" "+s+" ("+name_day[o]+" &rarr; "+name_day[i]+")",$("#date_night_"+e).html(n)}}function n(e){checkin[e]=void 0,checkout[e]=void 0,$("#arrivo_"+e).unbind("focus"),$("#partenza_"+e).unbind("focus"),$("#arrivo_button_"+e).unbind("click"),$("#partenza_button_"+e).unbind("click")}function s(e){n(e);var a=new Date,t=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0);checkin[e]=$("#arrivo_"+e).datepicker({weekStart:1,language:locale,onRender:function(e){return e.valueOf()<t.valueOf()?"disabled":""}}).on("changeDate",function(a){var t=new Date(a.date),r=new Date(a.date);if(a.date.valueOf()>checkout[e].date.valueOf())r.setDate(r.getDate()+1),$("#partenza_button_"+e).text(("0"+r.getDate()).slice(-2)+"/"+("0"+(r.getMonth()+1)).slice(-2)+"/"+r.getFullYear()),checkout[e].setValue(r);else{var i=$("#partenza_"+e).val();i=i.substr(3,2)+"/"+i.substr(0,2)+"/"+i.substr(6,4),r=new Date(i)}$("#arrivo_button_"+e).text(("0"+t.getDate()).slice(-2)+"/"+("0"+(t.getMonth()+1)).slice(-2)+"/"+t.getFullYear()),$("#arrivo_button_"+e).removeClass("selected"),checkin[e].hide(e),checkin[e].update(),checkout[e].update(),$("#partenza_"+e)[0].focus(),$("#partenza_button_"+e).trigger("click"),o(e)}).data("datepicker"),checkout[e]=$("#partenza_"+e).datepicker({weekStart:1,language:locale,onRender:function(a){return a.valueOf()<=checkin[e].date.valueOf()?"disabled":""}}).on("changeDate",function(a){var t=new Date(a.date);$("#partenza_button_"+e).text(("0"+t.getDate()).slice(-2)+"/"+("0"+(t.getMonth()+1)).slice(-2)+"/"+t.getFullYear()),checkout[e].hide(e),checkin[e].update(),checkout[e].update(),o(e)}).data("datepicker"),o(e),$("#arrivo_"+e).bind("focus",function(){$("#daterange_"+e).addClass("left").removeClass("right"),$("#partenza_"+e).closest(".data_picker").addClass("opacity")}),$("#partenza_"+e).bind("focus",function(){$("#daterange_"+e).addClass("right").removeClass("left"),$("#arrivo_"+e).closest(".data_picker").addClass("opacity")}),$("#arrivo_button_"+e).bind("click",function(a){a.preventDefault(),checkin[e].show(),$(this).addClass("selected"),$("#date_info_"+e).hide(),$("#daterange_"+e).addClass("left").removeClass("right"),$("#partenza_"+e).closest(".data_picker").addClass("opacity")}),$("#partenza_button_"+e).bind("click",function(a){a.preventDefault(),checkout[e].show(),$(this).addClass("selected"),$("#date_info_"+e).hide(),$("#daterange_"+e).addClass("right").removeClass("left"),$("#arrivo_"+e).closest(".data_picker").addClass("opacity")})}function l(){$(".num_bambini").unbind("change")}function c(){l(),$(".num_bambini").bind("change",function(){var e=$(this).closest(".room").attr("id");$("#"+e+" .width_pannello_bambini").hide().find("select").prop("disabled",!0);var a=parseInt($(this).val());for(a>0?$(this).closest(".col-form").addClass("active-force"):$(this).closest(".col-form").removeClass("active-force"),i=0;i<5;i++)i<a?$("#"+e+" .bambini_eta_form_"+i).show().find("select").prop("disabled",!1):$("#"+e+" .bambini_eta_form_"+i).hide().find("select").prop("disabled",!1);if(a>0){var t=$eta_singolo;a>1&&(t=$eta,t=t.replace("%n%","<b>"+a+"</b>")),$("#"+e+" label.n_eta_bambini").html(t),$("#"+e+" .width_pannello_bambini").show()}else $("#"+e+" .width_pannello_bambini").hide();first=!1}).trigger("change")}$("#addCamera").click(function(e){e.preventDefault();var a=parseInt($("#numero_camere").val());$("#numero_camere").val(a+1);var t=$("#rooms-list .room").last().clone(),r=t.attr("id");t.hide(),t.attr("id","room_"+a),$("#rooms-list").append(t),$("#room_"+a+" .camera_label span").text(a+1),$("#room_"+a+" .date_info").attr("id","date_info_"+a),$("#room_"+a+" .date_night").attr("id","date_night_"+a),$("#room_"+a+" .daterange").attr("id","daterange_"+a),$("#room_"+a+" .flex_date").attr("id","flex_date_"+a),$("#room_"+a+" .arrivo").attr("id","arrivo_"+a),$("#room_"+a+" .partenza").attr("id","partenza_"+a),$("#room_"+a+" .arrivo_button").attr("id","arrivo_button_"+a),$("#room_"+a+" .partenza_button").attr("id","partenza_button_"+a);var o=$("#"+r+" .num_adulti ").val(),i=$("#"+r+" .num_bambini ").val();$("#room_"+a+" .num_adulti").val(o),$("#room_"+a+" .num_bambini").val(i);for(var d=0;d<i;d++)$("#room_"+a+" .bambini_eta_form_"+d+" .eta_select").val($("#"+r+" .bambini_eta_form_"+d+" .eta_select").val());$("#room_"+a+" .num_bambini ").attr("id","num_bambini_"+a),$("#room_"+a+" .width_pannello_bambini ").attr("id","pannello_bambini_"+a),$("#room_"+a+" .eta_select").each(function(e){$(this).attr("id","eta_"+a+"_"+e)}),l(),c(),n(a),s(a),t.show("fast",function(){$(document.body).trigger("sticky_kit:recalc")}),$("#delCamera").show("fast"),$(".camera_label").show(250)}),$("#delCamera").click(function(e){e.preventDefault();var a=parseInt($("#numero_camere").val());$("#rooms-list .room").last().find(".num_bambini").unbind("change"),n(a),2==a&&($("#delCamera").hide("fast"),$(".camera_label").hide(250)),$("#rooms-list .room").last().hide("fast",function(){$(this).remove(),$(document.body).trigger("sticky_kit:recalc")}),$("#numero_camere").val(a-1)}),$("#nome_input").keyup(function(){var e=$(this).val(),t=a(e);0==t?$("#nome_input").closest(".col-form").removeClass("error-form").removeClass("success-form"):1==t?$("#nome_input").closest(".col-form").addClass("error-form").removeClass("success-form"):$("#nome_input").closest(".col-form").addClass("success-form").removeClass("error-form")}).trigger("keyup"),$("#email_input, #email_coupon").keyup(function(){var a=$(this),t=a.val(),r=e(t);0==r?a.closest(".col-form").removeClass("error-form").removeClass("success-form"):1==r?a.closest(".col-form").addClass("error-form").removeClass("success-form"):a.closest(".col-form").addClass("success-form").removeClass("error-form")}).trigger("keyup"),$("#phone_input").keyup(function(){var e=$(this).val(),a=t(e);0==a?$("#phone_input").closest(".col-form").removeClass("error-form").removeClass("success-form"):1==a?$("#phone_input").closest(".col-form").addClass("error-form").removeClass("success-form"):$("#phone_input").closest(".col-form").addClass("success-form").removeClass("error-form")}).trigger("keyup"),$("textarea").each(function(){var e=$(this);e.css("height",e[0].scrollHeight+"px")}),$(".privacy_accept").click(function(){$(this).prop("checked")?$(".invia_button").prop("disabled","").css("opacity","1"):$(".invia_button").prop("disabled","disabled").css("opacity","0.5")}),$("#form_preventivo").submit(function(a){$("#submit_button").prop("disabled","disabled").val($("#submit_button").attr("data-action")),$("#errors").html(""),$(".col-form").removeClass("active").removeClass("error-form").removeClass("error-bambini");var t=$("#nome_input").val(),r=$("#email_input").val(),o=$(".arrivo"),i=$(".partenza"),n=$(".flex_date"),s=$("#trattamento").val(),l=!1;""==t&&(l=!0,$("#nome_input").closest(".col-form").addClass("active").addClass("error-form")),""!=s&&0!=s||(l=!0,$("#trattamento").closest(".col-form").addClass("active").addClass("error-form")),""==r&&(l=!0,$("#email_input").closest(".col-form").addClass("active").addClass("error-form")),e(r)<10&&(l=!0,$("#email_input").closest(".col-form").addClass("active").addClass("error-form")),o.each(function(){var e=$(this).val();e!=$data_default&&""!=e||(l=!0,$(this).closest(".col-form").addClass("error-form"))}),i.each(function(){var e=$(this).val();e!=$data_default&&""!=e||(l=!0,$(this).closest(".col-form").addClass("error-form"))});var c=[];n.each(function(e){$(this).is(":checked")?c[e]=1:c[e]=0}),$("#flex_date_value").val(c.toString());var d=$(".room").length;d>0&&$(".room").each(function(e){var a=$("#num_bambini_"+e).val();if(a>0)for(var t=0;t<a;t++){var r="eta_"+e+"_"+t,o=$("#"+r).val();"-1"==o&&(l=!0,console.log("errore eta bambini"),$(this).find("#pannello_bambini_"+e).find(".col-form").addClass("error-bambini"))}}),l&&(a.preventDefault(),$("#errors").html('<div class="alert alert-danger">'+$alertCampi+"</div><br />"),$("html, body").animate({scrollTop:"0px"}),$("#submit_button").prop("disabled",!1).val($("#submit_button").attr("data-label")))}),$(document).on("mousedown",function(e){0===$(e.target).closest(".datepicker.datepicker-inline, .datepicker.datepicker-dropdown, textarea").length&&$(".col-form.data_picker").removeClass("active")});var d=$(".room").length;d>0?($("#numero_camere").val(d),$(".room").each(function(e){s(e)}),c()):$("#numero_camere").val(1),d>1?$("#delCamera").show():$("#delCamera").hide(),setTimeout(function(){$(document.body).trigger("sticky_kit:recalc")},1e3)});