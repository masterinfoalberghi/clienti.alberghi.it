$(function(){function e(){$("#attendi").html("").hide(),$("#errors").html("").hide()}function a(){$(".tooltip-small").not("init").each(function(){$(this).hasClass("tooltip-small-left")?Tipped.create(this,$(this).data("title"),{hook:"leftmiddle",maxWidth:200}):Tipped.create(this,$(this).data("title"),{hook:"topleft",maxWidth:200}),$(this).addClass("init")})}function t(e,a,t){var r,i,o;i="D",dayNameFormat="ddd",r="D MM YYYY",diff=a.diff(e,"days"),o="",o+=1==diff?diff+" "+dizionario.email.notte[0]:diff+" "+dizionario.email.notte[1],o+=" ("+e.format(dayNameFormat)+" &rarr; "+a.format(dayNameFormat)+")",isNaN(diff)||$("#dateinfo_"+t).html(o)}function r(){$(".daterange").not(".init").each(function(){var e=$(this),a=e.parent().data("id"),r=(e.parent().data("flex"),moment($("#arrivo_"+a).val(),"D/M/Y")),i=moment($("#partenza_"+a).val(),"D/M/Y");$("#arrivo_button_"+a).html('<i class="icon-calendar-empty"></i>&nbsp;'+r.format("D MMM Y")+'<i class="icon-down-open"></i>'),$("#partenza_button_"+a).html('<i class="icon-calendar-empty"></i>&nbsp;'+i.format("D MMM Y")+'<i class="icon-down-open"></i>'),$("#arrivo_datepicker_"+a).datepicker({format:"dd/mm/yyyy",weekStart:1,startDate:moment().format("D/M/Y"),language:"it",todayHighlight:!0}).on("changeDate",function(e){var r=moment($("#arrivo_datepicker_"+a).datepicker("getDate")),i=moment($("#partenza_datepicker_"+a).datepicker("getDate"));$("#arrivo_button_"+a).html('<i class="icon-calendar-empty"></i>&nbsp;'+r.format("D MMM Y")+'<i class="icon-down-open"></i>'),$("#arrivo_"+a).val(r.format("D/M/Y")),i.isBefore(r)&&(i=r.add(1,"d"),$("#partenza_"+a).val(i.format("D/M/Y")),$("#partenza_datepicker_"+a).datepicker("setDate",i.format("D/M/Y")),$("#partenza_button_"+a).html('<i class="icon-calendar-empty"></i>&nbsp;'+i.format("D MMM Y")+'<i class="icon-down-open"></i>')),$("#arrivo_datepicker_"+a).datepicker("setRange",[r,i]),$("#partenza_datepicker_"+a).datepicker("setRange",[r,i]).datepicker("setStartDate",moment(e.date).add(1,"d").format("D/M/Y")),$(".arrivo_datepicker").hide(),$(".partenza_datepicker").hide(),$("#partenza_datepicker_"+a).show(),$(".select_icon").removeClass("selected"),$("#partenza_button_"+a).addClass("selected"),t(r,i,a)}),$("#partenza_datepicker_"+a).datepicker({format:"dd/mm/yyyy",weekStart:1,startDate:moment().add(1,"d").format("D/M/Y"),language:"it",todayHighlight:!0}).on("changeDate",function(e){var r=moment($("#arrivo_datepicker_"+a).datepicker("getDate"));isNaN(r)&&(r=moment($("#arrivo_"+a).val(),"DD/MM/YYYY"));var i=moment($("#partenza_datepicker_"+a).datepicker("getDate"));$("#partenza_"+a).val(i.format("D/M/Y")),$("#partenza_button_"+a).html('<i class="icon-calendar-empty"></i>&nbsp;'+i.format("D MMM Y")+'<i class="icon-down-open"></i>'),$("#arrivo_datepicker_"+a).datepicker("setRange",[r,i]),$("#partenza_datepicker_"+a).datepicker("setRange",[r,i]),$(".arrivo_datepicker").hide(),$(".partenza_datepicker").hide(),$(".select_icon").removeClass("selected"),t(r,i,a)}),$("#arrivo_datepicker_"+a).datepicker("setRange",[r,i]).datepicker("update",r.format("YYYY-MM-DD")),$("#partenza_datepicker_"+a).datepicker("setRange",[r,i]).datepicker("setStartDate",i.format("D/M/Y")).datepicker("update",i.format("YYYY-MM-DD")),t(r,i,a),$("#arrivo_button_"+a).click(function(e){e.preventDefault(),$(".select_icon").removeClass("selected"),$(".arrivo_datepicker").hide(),$(".partenza_datepicker").hide(),$("#arrivo_datepicker_"+a).show(),$(this).addClass("selected"),$(document.body).trigger("sticky_kit:recalc")}),$("#partenza_button_"+a).click(function(e){e.preventDefault(),$(".select_icon").removeClass("selected"),$(".arrivo_datepicker").hide(),$(".partenza_datepicker").hide(),$("#partenza_datepicker_"+a).show(),$(this).addClass("selected"),$(document.body).trigger("sticky_kit:recalc")}),e.addClass("init")})}function i(e){for(var a=parseInt(e.find("option:selected").text()),t=$("#pannello_bambini_"+e.data("id")),r=0;r<6;r++){var i=t.find(".bambini_eta_"+r);r<a?i.show():(i.hide(),i.find(">select").val("-1"))}a>0?t.fadeIn():t.fadeOut()}function o(){$(".num_bambini").not(".init").each(function(){var e=$(this);e.change(function(){i(e)}),e.addClass("init")}),$(".eta_select").not(".init").each(function(){$es=$(this),$es.change(function(){var e=$(this);e.parent().removeClass("success-form").removeClass("error-form"),"-1"!=e.val()&&e.parent().addClass("success-form")}),$es.addClass("init")})}var n=!1,s=!1;$("#form_preventivo").submit(function(a){$("#errors").html("").hide();var t=!1,r=$("#nome_input").val(),i=$("#email_input").val(),o=$("#phone_input").val(),n=$(".privacy_accept"),s="";e(),$("#submit_button").hide(),$(".loading-ajax").show(),$("#nome_input").parent().removeClass("error-form"),_validateName(r)<10&&(t=!0,s+=dizionario.email.nome_ko,$("#nome_input").parent().addClass("error-form")),_validateEmail(i)<10&&(t=!0,s+=dizionario.email.mail_ko,$("#email_input").parent().addClass("error-form")),1==_validateNumber(o)&&(t=!0,s+=dizionario.email.telefono_ko,$("#phone_input").parent().addClass("error-form")),_validatePrivacy(n)||(t=!0,s+=dizionario.email.privacy_ko);var d=$("#numero_camere").val();if(d>0)for(var c=0;c<d;c++){var l=$("#room_"+c+" .num_bambini").val();if(l>0)for(var m=0;m<l;m++){var p=$("#room_"+c+" .eta_select").eq(m).val();"-1"==p&&(t=!0,$("#room_"+c+" .bambini_eta_"+m).removeClass("success-form").addClass("error-form"))}}$(".flex_date").each(function(){$(this).hide(),$(this).is(":checked")?$(this).val(1):$(this).val(0).prop("checked","checked")}),t&&(a.preventDefault(),$("#errors").html(dizionario.email.campi_compilati+s).show(),$(".loading-ajax").hide(),$(".flex_date").show(),$("#submit_button").show())}),$("#nome_input").keyup(function(){var a=$(this).val(),t=_validateName(a);0==t?($("#nome_input").closest(".col-form").removeClass("error-form").removeClass("success-form"),s&&e()):1==t?$("#nome_input").closest(".col-form").addClass("error-form").removeClass("success-form"):($("#nome_input").closest(".col-form").addClass("success-form").removeClass("error-form"),s&&e())}).trigger("keyup"),$("#email_input").keyup(function(){var a=$(this),t=a.val(),r=_validateEmail(t);0==r?(a.closest(".col-form").removeClass("error-form").removeClass("success-form"),s&&e()):1==r?a.closest(".col-form").addClass("error-form").removeClass("success-form"):(a.closest(".col-form").addClass("success-form").removeClass("error-form"),s&&e())}).trigger("keyup"),$("#phone_input").keyup(function(){var a=$(this).val(),t=_validateNumber(a);0==t?($("#phone_input").closest(".col-form").removeClass("error-form").removeClass("success-form"),s&&e()):1==t?$("#phone_input").closest(".col-form").addClass("error-form").removeClass("success-form"):($("#phone_input").closest(".col-form").addClass("success-form").removeClass("error-form"),s&&e())}).trigger("keyup"),s=!0,$("#addCamera").click(function(e){e.preventDefault();var t=parseInt($("#numero_camere").val());$("#numero_camere").val(t+1);var i=$("#rooms-list .room").last(),n=i.clone();n.attr("id");n.hide(),n.attr("id","room_"+t),$("#rooms-list").append(n),$("#room_"+t+" .camera_label b").text(t+1),n.find(".daterange_select").attr("data-id",t),n.find(".dateinfo").attr("id","dateinfo_"+t),n.find(".daterange").removeClass("init").attr("id","data_picker_"+t).attr("data-id",t),n.find(".arrivo_datepicker").empty(),n.find(".partenza_datepicker").empty(),n.find(".arrivo").attr("id","arrivo_"+t),n.find(".partenza").attr("id","partenza_"+t),n.find(".arrivo_datepicker").attr("id","arrivo_datepicker_"+t),n.find(".partenza_datepicker").attr("id","partenza_datepicker_"+t),n.find(".arrivo_button").attr("id","arrivo_button_"+t),n.find(".partenza_button").attr("id","partenza_button_"+t),n.find(".pannello_bambini").attr("id","pannello_bambini_"+t).hide(),n.find(".num_adulti").val("2"),n.find(".num_bambini").attr("data-id",t).removeClass("init").val("0"),n.find(".eta_select").val("-1").removeClass("init"),n.find(".bambini_eta").addClass("error-form").removeClass("success-form"),n.find(".label_checkbox").attr("for","flex_date_"+t),n.find(".flex_date").attr("id","flex_date_"+t),n.find(".tooltip-small").removeClass("init"),r(),o(),a(),n.show("fast",function(){$(document.body).trigger("sticky_kit:recalc")}),$("#delCamera").show("fast"),$(".camera_label").show()}),$("#delCamera").click(function(e){if(!n){n=!0,e.preventDefault();var a=parseInt($("#numero_camere").val());2==a&&$(this).hide(),$("#rooms-list .room").last().hide("fast",function(){$(this).remove(),$(document.body).trigger("sticky_kit:recalc"),n=!1}),$("#numero_camere").val(a-1)}}),$(".privacy_accept").change(function(){$(this).prop("checked")?$("#submit_button").show():$("#submit_button").hide()}),a(),$(document).click(function(e){$(e.target).closest(".daterange_select").length||($(".arrivo_datepicker").hide(),$(".partenza_datepicker").hide(),$(".select_icon").removeClass("selected"))}),r(),o(),$(".flex_date").show()});